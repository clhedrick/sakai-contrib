<#--
/**********************************************************************************
 * $URL: https://source.sakaiproject.org/contrib/etudes/sakai-jforum/tags/2.9.11/jforum-tool/src/webapp/templates/default/forum_show.htm $
 * $Id: forum_show.htm 83559 2013-04-30 19:03:29Z murthy@etudes.org $ 
 *********************************************************************************** 
 * 
 * Copyright (c) 2008, 2009, 2010, 2011, 2012, 2013 Etudes, Inc. 
 * 
 * Licensed under the Apache License, Version 2.0 (the "License"); 
 * you may not use this file except in compliance with the License. 
 * You may obtain a copy of the License at 
 * 
 * http://www.apache.org/licenses/LICENSE-2.0 
 * 
 * Unless required by applicable law or agreed to in writing, software 
 * distributed under the License is distributed on an "AS IS" BASIS, 
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. 
 * See the License for the specific language governing permissions and 
 * limitations under the License. 
 * 
 * Portions completed before July 1, 2004 Copyright (c) 2003, 2004 Rafael Steil, All rights reserved, licensed under the BSD license. 
 * http://www.opensource.org/licenses/bsd-license.php 
 * 
 * Redistribution and use in source and binary forms, 
 * with or without modification, are permitted provided 
 * that the following conditions are met: 
 * 
 * 1) Redistributions of source code must retain the above 
 * copyright notice, this list of conditions and the 
 * following disclaimer. 
 * 2) Redistributions in binary form must reproduce the 
 * above copyright notice, this list of conditions and 
 * the following disclaimer in the documentation and/or 
 * other materials provided with the distribution. 
 * 3) Neither the name of "Rafael Steil" nor 
 * the names of its contributors may be used to endorse 
 * or promote products derived from this software without 
 * specific prior written permission. 
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT 
 * HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, 
 * BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF 
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR 
 * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL 
 * THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE 
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, 
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES 
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF 
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, 
 * OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER 
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER 
 * IN CONTRACT, STRICT LIABILITY, OR TORT 
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN 
 * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF 
 * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE 
 ***********************************************************************************/
 -->
<#include "header.htm"/>
<#import "../macros/pagination.ftl" as pagination>
<#import "../macros/presentation.ftl" as presentation/>

<link rel="alternate" type="application/rss+xml" title="RSS" href="${JForumContext.encodeURL("/rss/forumTopics/${forum.id}")}" />

<script type="text/JavaScript" src="${JForumContext.encodeURL("/js/list/moderation")}"></script>
<script language="JavaScript" type="text/javascript">
				//
				// Should really check the browser to stop this whining ...
				//
				function select_switch(status) 
				{
					for (i = 0; i < document.form1.length; i++) {
						document.form1.elements[i].checked = status;
					}
				}
				
				var status = false;
				function select_switch() 
				{
					if (status)
					{
						status = false;	
					}
					else
					{
						status = true;
					}
					
					for (i = 1; i < document.form1.length; i++) 
					{
						document.form1.elements[i].checked = status;
					}
				}
				
				function toggle_switch(ele)
				{
					var chkAllEle = document.getElementsByName("chkAll");
					
					if (!ele.checked)
					{
						for (i = 0; i < chkAllEle.length; i++) 
						{
							chkAllEle[i].checked = false;
						}
					}
					else
					{
						var allStatus = true;
						
						var eleId = document.getElementsByName("topic_id");
						
						for (i = 0; i < eleId.length; i++) 
						{						
							if (!eleId[i].checked)
							{
								allStatus = false;
								break;
							}
						}
						
						for (i = 0; i < chkAllEle.length; i++) 
						{
							chkAllEle[i].checked = allStatus;
						}
					}
				}
				</script>

<table cellspacing="0" cellpadding="10" width="100%" align="center" border="0">
<#assign zdivindex = 500/>
	<tr>
		<td valign="top">
			<#if moderator>
				<form action="${JForumContext.encodeURL("/jforum")}" method="post" name="form1" id="form1" accept-charset="${encoding}">
				<input type="hidden" name="action" value="doModeration" />
				<input type="hidden" name="module" value="${moduleName}" />
				<input type="hidden" name="securityHash" value="${securityHash}" />
				<input type="hidden" name="persistData" value="${forum.id}" />
				<input type="hidden" name="forum_id" value="${forum.id}" />
			<#else>
              <form action="${JForumContext.encodeURL("/jforum")}" method="post" name="form1" id="form1" accept-charset="${encoding}">
				<input type="hidden" name="action" value="doModeration" />
				<input type="hidden" name="module" value="${moduleName}" />
				<input type="hidden" name="forum_id" value="${forum.id}" />	
			</#if>
			<input type="hidden" id="markTopics" name="markTopics" value=""/>
			<input type="hidden" id="actionMode" name="actionMode" value=""/>
			<table cellspacing="2" cellpadding="2" width="100%" align="center" border="0">
				<tr>
					<td valign="middle" align="left" colspan="2">
						<a class="maintitle" href="${JForumContext.encodeURL("/forums/show/${forum.id}")}">${forum.name}</a>
						<#if forum.grade?? && forum.grade.isMinimumPostsRequired()>
						<span class="genmedmaroon">
							</br>(${I18n.getMessage("Grade.MinPostsNumber.Show", forum.grade.minimumPosts)})							
						</span>
						</#if>
					</td>
				</tr>
				<tr>
					<td valign="bottom" align="left" colspan="2">
						<#if forum.description??>
								<#if forum.description?trim?length < 300>
									<span class="gen">${forum.description?default("")}</span>
								<#else>
									<#assign zdivindex = zdivindex - 1/>
									<div class="confirmpanel1" style="z-index:${zdivindex}">
									<span class="gen">
										${(forum.description?trim?substring(0, 300))}...&nbsp; 
										<a href="#" onclick="showElement('frm_desc_${forum.id}');return false;">${I18n.getMessage("Forum.Description.More")}...</a>
									</span>
									<#assign zdivindex = zdivindex - 1/>
									<#if forum.description?trim?length < 600>
									<div class="confirmpanel6" style="display:none;z-index:${zdivindex}" id="frm_desc_${forum.id}">
									<#else>
									<div class="confirmpanel7" style="display:none;z-index:${zdivindex}" id="frm_desc_${forum.id}">
									</#if>
									<table cellpadding="2" cellspacing="2" width="100%">
										<tr>
											<td width="100%" rowspan="2">
												<span class="gen">
												${forum.description}
												</span>
											</td>									
											<td width="2" nowrap="nowrap" align="right" valign="top">
												<a><img src="${contextPath}/templates/${templateName}/images/delete.png" alt="${I18n.getMessage("Frame.Close")}" title="${I18n.getMessage("Frame.Close")}" onclick="hideElement('frm_desc_${forum.id}');return false;"></a>
											</td>
										</tr>
										<tr>									
											<td>&nbsp;</td>
										</tr>
										<tr>
											<td colspan="2" style="" align="left">
												&nbsp;&nbsp;&nbsp;&nbsp;<input type="button" value="OK" onclick="hideElement('frm_desc_${forum.id}');return false;" style="padding-left:2em; background: #eee url('${contextPath}/templates/${templateName}/images/ok.png') .2em no-repeat;"/>
											</td>
										</tr>
									</table>
									</div>								
									</div>
								</#if>
							</#if>
					</td>
				</tr>
				
				<tr>
					<td colspan="2" height="2"><img src="${contextPath}/templates/${templateName}/images/spacer.gif" alt="" width="1" height="2" /></td>
				</tr>
				<tr>
					<td valign="middle" align="left" width="98%">
					    <span class="nav">
							<a class="gen" href="${JForumContext.encodeURL("/forums/list")}">${I18n.getMessage("ForumListing.forumIndex")}</a> -&gt; <a class="gen" href="${JForumContext.encodeURL("/forums/list")}#${category.id}">${category.title}</a> -&gt; <a class="gen" href="${JForumContext.encodeURL("/forums/show/${forum.id}")}">${forum.name}</a>
						</span>
					</td>
					<td valign="middle" nowrap="nowrap" align="right" width="300"><@pagination.doPagination action, forum.id/></td>
				</tr>
				<tr>
					<td colspan="2" height="2"><img src="${contextPath}/templates/${templateName}/images/spacer.gif" alt="" width="1" height="2" /></td>
				</tr>
				<#assign userCatgAccess = true/>
				<#if !facilitator>
					<#if (specialAccessUser)>
						<#if (!specialAccessUserAccess)>
							<#assign userCatgAccess = false/>
				   		</#if>
				   	<#else>				   	
				   		<#if (category.accessDates.allowUntilDate??)>
							<#if (category.accessDates.allowUntilDate?datetime lt nowDate?datetime)>
								<#assign userCatgAccess = false/>
							</#if>
						<#elseif (category.accessDates.dueDate??) && (category.accessDates.dueDate?datetime lt nowDate?datetime)>
							<#assign userCatgAccess = false/>
						<#elseif (forum.accessDates.allowUntilDate??)>
							<#if (forum.accessDates.allowUntilDate?datetime lt nowDate?datetime)>
								<#assign userCatgAccess = false/>
							</#if>
						<#elseif (forum.accessDates.dueDate??) && (forum.accessDates.dueDate?datetime lt nowDate?datetime)>
							<#assign userCatgAccess = false/>
						</#if>
					</#if>
				</#if>
			</table>

			

			<table class="forumline" cellspacing="1" cellpadding="4" width="100%" border="0">
				<#if errorMessage?exists>
					<tr>
						<td colspan="8" align="center"><span class="redclass">${errorMessage}</span></td>
					</tr>
				</#if>
				<tr>
					<td class="nav" colspan="4" valign="middle" nowrap="nowrap" align="left">
						<#if forum.mayCreateTopic()>
							<span class="gen">
						  		<a class="gen" href="${JForumContext.encodeURL("/jforum${extension}?module=posts&action=insert&forum_id=${forum.id}", "")}" accesskey="${I18n.getMessage("new-access")}" rel="nofollow" ><img class="imgicon" src="${contextPath}/templates/${templateName}/images/new.png" alt="${I18n.getMessage("add-topic-description")}" title="${I18n.getMessage("add-topic-access-description")}"/>${I18n.getMessage("ForumListing.newTopic")}</a>
						  	</span>
						<#else>
							 <#if !userCatgAccess>
							 <span class="gen">
							 	<img class="imgicon" src="${contextPath}/templates/${templateName}/images/topic_lock.png" alt="${I18n.getMessage("locked-description")}" title="${I18n.getMessage("locked-description")}"/>${I18n.getMessage("locked")}
							 </span>
							 </#if>
						</#if>
						<#if (topics.size() > 0) && moderator  && openModeration?default(false)>
						&nbsp;<@presentation.moderationButtons/>&nbsp;
						</#if>
					</td>
					<td class="nav" colspan="4" valign="middle" nowrap="nowrap" align="right">
		  				<span class="gen">
		  				<#if moderator>
														
							<#if openModeration?default(false)>
								<#assign link = ""/>
								<#if (start > 0)>
									<#assign link = JForumContext.encodeURL("/forums/show/" + start + "/" + forum.id)/>
								<#else>
									<#assign link = JForumContext.encodeURL("/forums/show/" + forum.id)/>
								</#if>
								 
								 <#if (forum.gradeType == gradeForum)>
									<#if facilitator>
										<a href="${JForumContext.encodeURL("/gradeForum/evalForumList/${forum.id}/name/a")}">
										<img class="imgicon" src="${contextPath}/templates/${templateName}/images/grade.png" alt="grade icon" title="${I18n.getMessage("grade-forum-title")}"/>${I18n.getMessage("ForumListing.gradeForum")}
										</a>
										&nbsp;
									<#else>
										<a href="${JForumContext.encodeURL("/gradeForum/viewForumGrade/${forum.id}")}">
										<img class="imgicon" src="${contextPath}/templates/${templateName}/images/grade.png" alt="grade icon" title="${I18n.getMessage("view-forum-grade-title")}"/>${I18n.getMessage("ForumListing.viewForumGrade")}
										</a>
										&nbsp;
									</#if>
								</#if>
								<a id="markTopicsRead2" class="gen" href="#" onclick="topicModeration('markTopics');return false;"><img class="imgicon" src="${contextPath}/templates/${templateName}/images/refresh.png" alt="mark topic unread icon"/>${I18n.getMessage("PostShow.markTopicUnread")}</a>
							<#else>
								<a href="${contextPath}/forums/moderation/<#if (start > 0)>${start}/</#if>${forum.id}${extension}">${I18n.getMessage("Moderation.OpenModeration")}</a>
								 
								 <#if (forum.gradeType == gradeForum)>
									<#if facilitator>
										<a href="${JForumContext.encodeURL("/gradeForum/evalForumList/${forum.id}/name/a")}">
										<img class="imgicon" src="${contextPath}/templates/${templateName}/images/grade.png" alt="grade icon" title="${I18n.getMessage("grade-forum-title")}"/>${I18n.getMessage("ForumListing.gradeForum")}
										</a>
										&nbsp;
									<#else>
										<a href="${JForumContext.encodeURL("/gradeForum/viewForumGrade/${forum.id}")}">
										<img class="imgicon" src="${contextPath}/templates/${templateName}/images/grade.png" alt="grade icon" title="${I18n.getMessage("view-forum-grade-title")}"/>${I18n.getMessage("ForumListing.viewForumGrade")}
										</a>
										&nbsp;
									</#if>
								</#if>
								<a id="markTopicsRead2" class="gen" href="#" onclick="topicModeration('markTopics');return false;"><img class="imgicon" src="${contextPath}/templates/${templateName}/images/refresh.png" alt="mark topic unread icon"/>${I18n.getMessage("PostShow.markTopicUnread")}</a>
	                             
							</#if>
						<#else>
			            
				            <#if (forum.gradeType == gradeForum)>
								<#if facilitator>
									<a href="${JForumContext.encodeURL("/gradeForum/evalForumList/${forum.id}/name/a")}">
									<img class="imgicon" src="${contextPath}/templates/${templateName}/images/grade.png" alt="grade icon" title="${I18n.getMessage("grade-forum-title")}"/>${I18n.getMessage("ForumListing.gradeForum")}
									</a>
									&nbsp;
								<#else>
									<a href="${JForumContext.encodeURL("/gradeForum/viewForumGrade/${forum.id}")}">
									<img class="imgicon" src="${contextPath}/templates/${templateName}/images/grade.png" alt="grade icon" title="${I18n.getMessage("view-forum-grade-title")}"/>${I18n.getMessage("ForumListing.viewForumGrade")}
									</a>
									&nbsp;
								</#if>
							</#if>
	                    <a id="markTopicsRead2" class="gen" href="#" onclick="topicModeration('markTopics');return false;"><img class="imgicon" src="${contextPath}/templates/${templateName}/images/refresh.png" alt="mark topic unread icon"/>${I18n.getMessage("PostShow.markTopicUnread")}</a>
			            </#if>
						
						</span>
					</td>
				</tr>
				<tr>
					<th class="thCornerL" nowrap="nowrap" width="5%" valign="middle" align="center">
						<#if (topics.size() > 0)>
						<input type="checkbox" id="chkAll" name="chkAll" onclick="javascript:select_switch();" />
						</#if>
					</th>
					<th class="thCornerL" nowrap="nowrap" align="middle" colspan="2" height="25">&nbsp;${I18n.getMessage("ForumIndex.topics")}&nbsp;</th>
					<#if (!facilitator && (forum.gradeType == gradeTopic))>
						<th class="thTop" nowrap="nowrap" align="middle" width="30" height="25">&nbsp;</th>
					</#if>
					<#if (forum.gradeType == gradeTopic)>
						<th class="thTop" nowrap="nowrap" align="middle" width="100" height="25">&nbsp;${I18n.getMessage("ForumIndex.scores")}&nbsp;</th>
					</#if>
					<th class="thTop" nowrap="nowrap" align="middle" width="50">&nbsp;${I18n.getMessage("ForumIndex.answers")}&nbsp;</th>
					<th class="thTop" nowrap="nowrap" align="middle" width="100">&nbsp;${I18n.getMessage("ForumIndex.author")}&nbsp;</th>
					<th class="thCornerR" nowrap="nowrap" align="middle">&nbsp;${I18n.getMessage("ForumIndex.lastMessage")}&nbsp;</th>				
				</tr>
				<#assign zdivindex = 500/>
				<!-- TOPICS LISTING -->
				<#list topics as topic>
					<#assign class1>class="<@presentation.row1Class topic/>"</#assign>
					<#assign class2>class="<@presentation.row2Class topic/>"</#assign>
					<#assign class3>class="<@presentation.row3Class topic/>"</#assign>

					<#assign specialAccessUserTopic = false/>
					
					<#if (!facilitator) && (topic.specialAccess.size() == 1)>											
						<#assign specialAccessUserTopic = true/>						
						<#assign userSpecialAccess = topic.specialAccess.get(0)>
					</#if>		
					
					<tr>
						<td ${class1} valign="middle" align="center"><input type="checkbox" name="topic_id" value="${topic.id}" onclick="javascript:toggle_switch(this);" /></td>
						<td ${class1} valign="middle" align="left" width="50" nowrap="nowrap">
							<#if (specialAccessUserTopic)>
								<@presentation.folderImageSpecialAccess topic, userSpecialAccess/>
							<#else>
								<@presentation.folderImage topic/>
							</#if>
							<#if (facilitator) && (topic.accessDates.openDate?? && topic.accessDates.dueDate??) && (topic.accessDates.openDate > topic.accessDates.dueDate)>
								<#assign zdivindex = zdivindex - 1/>
								<span class="confirmpanel1" style="z-index:${zdivindex}">
								<span class="gensmaller">
								<a href="#" onclick="showElement('tpc_dt_invalid_${topic.id}');return false;"><img src="${contextPath}/templates/${templateName}/images/warning.png" alt="${I18n.getMessage("dates-invalid")}" title="${I18n.getMessage("dates-invalid")}"/></a>
								</span>
								<#assign zdivindex = zdivindex - 1/>
								<span class="confirmpanel3" style="display:none;z-index:${zdivindex}" id="tpc_dt_invalid_${topic.id}">
								<table cellpadding="2" cellspacing="0" width="100%">
								<tr>
									<td colspan="2">
										&nbsp;
									</td>
								</tr>
								<tr>									
									<td colspan="2" align="left">
										<span class="gen">
											&nbsp;&nbsp;
											${I18n.getMessage("Dates.Invalid.Alert")}
										</span>
									</td>
								</tr>
								<tr>
									<td width="50">
										&nbsp;
									</td>
									<td style="" align="left">
										&nbsp;&nbsp;<input type="button" value="OK" onclick="hideElement('tpc_dt_invalid_${topic.id}');return false;" style="padding-left:2em; background: #eee url('${contextPath}/templates/${templateName}/images/ok.png') .2em no-repeat;"/>
									</td>
								</tr>
								<tr>
									<td colspan="2">
										&nbsp;
									</td>
								</tr>
								</table>
								</span>
								
								</span>
							</#if>				
						</td>
						<td ${class1} width="100%">
							<#if topic.hasAttach() && attachmentsEnabled><img src="${contextPath}/templates/${templateName}/images/icon_clip.gif" align="middle" alt="attachment icon" title="${I18n.getMessage("topic-attachment-title")}"></#if>
				
							<span class="gen">
							<#if (facilitator)>
								<a href="${JForumContext.encodeURL("/posts/list/${topic.id}")}"><#if (topic.title?length == 0)>No Subject<#else>${topic.title?html}</#if></a>
							<#else>
								<#if (topic.getBlocked())>
									<span class="gen">
									<#if (topic.title?length == 0)>No Subject<#else>${topic.title?html}</#if>
									</span>
								<#elseif (specialAccessUserTopic)>
									<#if userSpecialAccess.accessDates.openDate?? && (userSpecialAccess.accessDates.openDate?datetime gt nowDate?datetime)>
										<span class="gen">
										<#if (topic.title?length == 0)>No Subject<#else>${topic.title?html}</#if>
										</span>
									<#else>
										<span class="gen">
										<a href="${JForumContext.encodeURL("/posts/list/${topic.id}")}"><#if (topic.title?length == 0)>No Subject<#else>${topic.title?html}</#if></a>
										</span>
									</#if>
								<#elseif (topic.accessDates?? && topic.accessDates.openDate??) && (topic.accessDates.openDate?datetime gt nowDate?datetime)>
									<span class="gen">
									<#if (topic.title?length == 0)>No Subject<#else>${topic.title?html}</#if>
									</span>
								<#else>
									<span class="gen">
									<a href="${JForumContext.encodeURL("/posts/list/${topic.id}")}"><#if (topic.title?length == 0)>No Subject<#else>${topic.title?html}</#if></a>
									</span>
								</#if>
							</#if>
							</span>
							
							<span class="gen">
								<#if (specialAccessUserTopic)>
									<#if userSpecialAccess.accessDates.openDate??>
										- ${I18n.getMessage("ForumListing.topic.startDate")}&nbsp;${DateUtil.getStringFromDate(userSpecialAccess.accessDates.openDate)}
									</#if>
									<#if userSpecialAccess.accessDates.dueDate??>
										- ${I18n.getMessage("ForumListing.topic.endDate")}&nbsp;${DateUtil.getStringFromDate(userSpecialAccess.accessDates.dueDate)}
									</#if>
								<#else>
									<#if topic.accessDates.openDate??>
										- ${I18n.getMessage("ForumListing.topic.startDate")}&nbsp;${DateUtil.getStringFromDate(topic.accessDates.openDate)}
									</#if>
									<#if topic.accessDates.dueDate??>
										- ${I18n.getMessage("ForumListing.topic.endDate")}&nbsp;${DateUtil.getStringFromDate(topic.accessDates.dueDate)}
									</#if>
								</#if>
							</span>

							<#if topic.paginate>
								<#if (topic.getBlocked())>
								<#elseif (specialAccessUserTopic)>
									<#if userSpecialAccess.accessDates.openDate?? && (userSpecialAccess.accessDates.openDate?datetime gt nowDate?datetime)>
									<#else>
										<span class="gensmall">
										<br />
										<@pagination.littlePostPagination topic.id, postsPerPage, topic.totalReplies/>				
										</span>
									</#if>
								<#elseif (topic.accessDates?? && topic.accessDates.openDate??) && (topic.accessDates.openDate?datetime gt nowDate?datetime)>
								<#else>
									<span class="gensmall">
									<br />
									<@pagination.littlePostPagination topic.id, postsPerPage, topic.totalReplies/>				
									</span>
								</#if>
							</#if>		
						</td>
						<#if (!facilitator && forum.gradeType == gradeTopic)>
							<td ${class2} align="middle" nowrap="nowrap">
							<#if (topic.getBlocked())>
								<#assign zdivindex = zdivindex - 1/>
								<div class="confirmpanel1" style="z-index:${zdivindex}">
								<span class="gensmall">
								<a href="#" onclick="showElement('top_pre_req_${topic.id}');return false;"><img src="${contextPath}/templates/${templateName}/images/lock.png" alt="${I18n.getMessage("Prerequisite.Title")}"/></br>${I18n.getMessage("Prerequisite.Title")}</a>
								</span>
								
								<#assign zdivindex = zdivindex - 1/>
								<div class="confirmpanel2" style="display:none;z-index:${zdivindex}" id="top_pre_req_${topic.id}">
								<table cellpadding="2" cellspacing="2" width="100%">
								<tr>
									<td colspan="2" align="left">
										<span class="gen">
											${I18n.getMessage("Prerequisite.Alert")}<#if topic.blockedByDetails??>&nbsp;${topic.blockedByDetails}</#if>:
											<ul>
												<#if topic.blockedByTitle??>
												<li>${topic.blockedByTitle}</li>
												</#if>
											</ul>
										</span>
									</td>
								</tr>
								<tr>
									<td width="50">
										&nbsp;
									</td>
									<td style="" align="left">
										&nbsp;&nbsp;<input type="button" value="OK" onclick="hideElement('top_pre_req_${topic.id}');return false;" style="padding-left:2em; background: #eee url('${contextPath}/templates/${templateName}/images/ok.png') .2em no-repeat;"/>
									</td>
								</tr>
								<tr>
									<td colspan="2">
										&nbsp;
									</td>
								</tr>
								</table>
								</div>
								
								</div>
							<#else>
								&nbsp;
							</#if>
						</td>
						</#if>
						<#if (forum.gradeType == gradeTopic)>
							<td ${class2} valign="middle" align="center" nowrap="nowrap">
								<span class="gen">
									<#if (topic.isGradeTopic())>
										<#if facilitator>
											<img src="${contextPath}/templates/${templateName}/images/grade_by_topic.gif" alt="grade topics"/>
											<a href="${JForumContext.encodeURL("/gradeForum/evalTopicList/${topic.id}/name/a")}">${I18n.getMessage("ForumIndex.gradeTopic")}</a>
										<#else>
											<#if (topic.getBlocked())>
													${I18n.getMessage("ForumIndex.viewGrade")}
											<#elseif (specialAccessUserTopic)>
												<#if userSpecialAccess.accessDates.openDate?? && (userSpecialAccess.accessDates.openDate?datetime gt nowDate?datetime)>
													${I18n.getMessage("ForumIndex.viewGrade")}
												<#else>
													<img src="${contextPath}/templates/${templateName}/images/grade_by_topic.gif" alt="view topics grade"/>
													<a href="${JForumContext.encodeURL("/gradeForum/viewTopicGrade/${topic.id}")}">${I18n.getMessage("ForumIndex.viewGrade")}</a>
												</#if>
											<#elseif (topic.accessDates?? && topic.accessDates.openDate??) && (topic.accessDates.openDate?datetime gt nowDate?datetime)>
												${I18n.getMessage("ForumIndex.viewGrade")}
											<#else>
												<img src="${contextPath}/templates/${templateName}/images/grade_by_topic.gif" alt="view topics grade"/>
												<a href="${JForumContext.encodeURL("/gradeForum/viewTopicGrade/${topic.id}")}">${I18n.getMessage("ForumIndex.viewGrade")}</a>
											</#if>
										</#if>
									</#if>
								</span>
							</td>
						</#if>
						
						<#assign totalReplies = topic.totalReplies + 1/>
						<td ${class2} valign="middle" align="center"><span class="gen">${totalReplies}</span></td>
						<td ${class3} valign="middle" align="center">
							<span class="gen"><a href="${JForumContext.encodeURL("/user/profile/${topic.postedBy.id}")}">${topic.postedBy.firstName?default("")}&nbsp;${topic.postedBy.lastName?default("")}</a></span>
						</td>

						<td ${class2} valign="middle" nowrap="nowrap" align="center">
							<#if (topic.lastPostTime?length > 0)>
								<span class="gen">
								<#if (topic.getBlocked())>
									${DateUtil.getStringFromDate(topic.lastPostTime)}<br />
									<a href="${JForumContext.encodeURL("/user/profile/${topic.lastPostBy.id}")}">${topic.lastPostBy.firstName?default("")}&nbsp;${topic.lastPostBy.lastName?default("")}</a>
								<#elseif (specialAccessUserTopic)>
									<#if userSpecialAccess.accessDates.openDate?? && (userSpecialAccess.accessDates.openDate?datetime gt nowDate?datetime)>
										${DateUtil.getStringFromDate(topic.lastPostTime)}<br />
										<a href="${JForumContext.encodeURL("/user/profile/${topic.lastPostBy.id}")}">${topic.lastPostBy.firstName?default("")}&nbsp;${topic.lastPostBy.lastName?default("")}</a>
									<#else>
										${DateUtil.getStringFromDate(topic.lastPostTime)}<br />
										<a href="${JForumContext.encodeURL("/user/profile/${topic.lastPostBy.id}")}">${topic.lastPostBy.firstName?default("")}&nbsp;${topic.lastPostBy.lastName?default("")}</a>
		
										<#assign startPage = ""/>
										<#if (topic.totalReplies + 1 > postsPerPage?number)>
											<#assign startPage = ((topic.totalReplies / postsPerPage?number)?int * postsPerPage?number) +"/"/>
										</#if>
							  
										<a href="${JForumContext.encodeURL("/posts/list/${startPage}${topic.id}")}#${topic.lastPostId}"><img src="${contextPath}/templates/${templateName}/images/icon_latest_reply.gif" width="18" height="9" border="0" alt="last reply icon" title="${I18n.getMessage("latest-reply-title")}"/></a>
									</#if>
								<#elseif (topic.accessDates?? && topic.accessDates.openDate??) && (topic.accessDates.openDate?datetime gt nowDate?datetime)>
									${DateUtil.getStringFromDate(topic.lastPostTime)}<br />
									<a href="${JForumContext.encodeURL("/user/profile/${topic.lastPostBy.id}")}">${topic.lastPostBy.firstName?default("")}&nbsp;${topic.lastPostBy.lastName?default("")}</a>
								<#else>
									${DateUtil.getStringFromDate(topic.lastPostTime)}<br />
									<a href="${JForumContext.encodeURL("/user/profile/${topic.lastPostBy.id}")}">${topic.lastPostBy.firstName?default("")}&nbsp;${topic.lastPostBy.lastName?default("")}</a>
	
									<#assign startPage = ""/>
									<#if (topic.totalReplies + 1 > postsPerPage?number)>
										<#assign startPage = ((topic.totalReplies / postsPerPage?number)?int * postsPerPage?number) +"/"/>
									</#if>
						  
									<a href="${JForumContext.encodeURL("/posts/list/${startPage}${topic.id}")}#${topic.lastPostId}"><img src="${contextPath}/templates/${templateName}/images/icon_latest_reply.gif" width="18" height="9" border="0" alt="last reply icon" title="${I18n.getMessage("latest-reply-title")}"/></a>
								</#if>
								</span>
							</#if>		 
						</td>
					</tr>
				</#list>		
				<!-- END OF TOPICS LISTING -->
				
				<tr>
					<td class="catBottomL" nowrap="nowrap" valign="middle" align="center">
						<#if (topics.size() > 0)>
						<input type="checkbox" id="chkAll" name="chkAll" onclick="javascript:select_switch();" />
						</#if>
					</td>
					<td class="catBottom" nowrap="nowrap" valign="middle" align="center" colspan="8">
						&nbsp;
					</td>
					<#--td class="catBottom" valign="center" align="left" colspan="<#if moderator && openModeration?default(false)>8<#else>8</#if>" height="28">
					<#if (topics.size() > 0)>
					&nbsp;<@presentation.moderationButtons/>
					</#if-->
				</tr>
				
				<tr>
					<td class="nav" colspan="4" valign="middle" nowrap="nowrap" align="left">
						<#if forum.mayCreateTopic()>
							<span class="gen">
						  		<a class="gen" href="${JForumContext.encodeURL("/jforum${extension}?module=posts&action=insert&forum_id=${forum.id}", "")}" accesskey="${I18n.getMessage("new-access")}" rel="nofollow" ><img class="imgicon" src="${contextPath}/templates/${templateName}/images/new.png" alt="${I18n.getMessage("add-topic-description")}" title="${I18n.getMessage("add-topic-access-description")}"/>${I18n.getMessage("ForumListing.newTopic")}</a>
						  	</span>
						<#else>
							 <#if !userCatgAccess>
							 <span class="gen">
							 	<img class="imgicon" src="${contextPath}/templates/${templateName}/images/topic_lock.png" alt="${I18n.getMessage("locked-description")}" title="${I18n.getMessage("locked-description")}"/>${I18n.getMessage("locked")}
							 </span>
							 </#if>
						</#if>
						<#if (topics.size() > 0) && moderator  && openModeration?default(false)>
						&nbsp;<@presentation.moderationButtons/>&nbsp;
						</#if>
					</td>
					<td class="nav" colspan="4" valign="middle" nowrap="nowrap" align="right">
		  				<span class="gen">
		  				<#if moderator>
														
							<#if openModeration?default(false)>
								<#assign link = ""/>
								<#if (start > 0)>
									<#assign link = JForumContext.encodeURL("/forums/show/" + start + "/" + forum.id)/>
								<#else>
									<#assign link = JForumContext.encodeURL("/forums/show/" + forum.id)/>
								</#if>
								 
								 <#if (forum.gradeType == gradeForum)>
									<#if facilitator>
										<a href="${JForumContext.encodeURL("/gradeForum/evalForumList/${forum.id}/name/a")}">
										<img class="imgicon" src="${contextPath}/templates/${templateName}/images/grade.png" alt="grade icon" title="${I18n.getMessage("grade-forum-title")}"/>${I18n.getMessage("ForumListing.gradeForum")}
										</a>
										&nbsp;
									<#else>
										<a href="${JForumContext.encodeURL("/gradeForum/viewForumGrade/${forum.id}")}">
										<img class="imgicon" src="${contextPath}/templates/${templateName}/images/grade.png" alt="grade icon" title="${I18n.getMessage("view-forum-grade-title")}"/>${I18n.getMessage("ForumListing.viewForumGrade")}
										</a>
										&nbsp;
									</#if>
								</#if>
								<a id="markTopicsRead2" class="gen" href="#" onclick="topicModeration('markTopics');return false;"><img class="imgicon" src="${contextPath}/templates/${templateName}/images/refresh.png" alt="mark topic unread icon"/>${I18n.getMessage("PostShow.markTopicUnread")}</a>
							<#else>
								<a href="${contextPath}/forums/moderation/<#if (start > 0)>${start}/</#if>${forum.id}${extension}">${I18n.getMessage("Moderation.OpenModeration")}</a>
								 
								 <#if (forum.gradeType == gradeForum)>
									<#if facilitator>
										<a href="${JForumContext.encodeURL("/gradeForum/evalForumList/${forum.id}/name/a")}">
										<img class="imgicon" src="${contextPath}/templates/${templateName}/images/grade.png" alt="grade icon" title="${I18n.getMessage("grade-forum-title")}"/>${I18n.getMessage("ForumListing.gradeForum")}
										</a>
										&nbsp;
									<#else>
										<a href="${JForumContext.encodeURL("/gradeForum/viewForumGrade/${forum.id}")}">
										<img class="imgicon" src="${contextPath}/templates/${templateName}/images/grade.png" alt="grade icon" title="${I18n.getMessage("view-forum-grade-title")}"/>${I18n.getMessage("ForumListing.viewForumGrade")}
										</a>
										&nbsp;
									</#if>
								</#if>
								<a id="markTopicsRead2" class="gen" href="#" onclick="topicModeration('markTopics');return false;"><img class="imgicon" src="${contextPath}/templates/${templateName}/images/refresh.png" alt="mark topic unread icon"/>${I18n.getMessage("PostShow.markTopicUnread")}</a>
	                             
							</#if>
						<#else>
			            
				            <#if (forum.gradeType == gradeForum)>
								<#if facilitator>
									<a href="${JForumContext.encodeURL("/gradeForum/evalForumList/${forum.id}/name/a")}">
									<img class="imgicon" src="${contextPath}/templates/${templateName}/images/grade.png" alt="grade icon" title="${I18n.getMessage("grade-forum-title")}"/>${I18n.getMessage("ForumListing.gradeForum")}
									</a>
									&nbsp;
								<#else>
									<a href="${JForumContext.encodeURL("/gradeForum/viewForumGrade/${forum.id}")}">
									<img class="imgicon" src="${contextPath}/templates/${templateName}/images/grade.png" alt="grade icon" title="${I18n.getMessage("view-forum-grade-title")}"/>${I18n.getMessage("ForumListing.viewForumGrade")}
									</a>
									&nbsp;
								</#if>
							</#if>
	                    <a id="markTopicsRead2" class="gen" href="#" onclick="topicModeration('markTopics');return false;"><img class="imgicon" src="${contextPath}/templates/${templateName}/images/refresh.png" alt="mark topic unread icon"/>${I18n.getMessage("PostShow.markTopicUnread")}</a>
			            </#if>
						
						</span>
					</td>
				</tr>
			</table>

			<table cellspacing="2" cellpadding="2" width="100%" align="center" border="0">
				<tr>
					<td colspan="2" height="2"><img src="${contextPath}/templates/${templateName}/images/spacer.gif" alt="" width="1" height="2" /></td>
				</tr>
				<tr>
					<td valign="middle" align="left" width="98%">
					    <span class="nav">
							<a class="gen" href="${JForumContext.encodeURL("/forums/list")}">${I18n.getMessage("ForumListing.forumIndex")}</a> -&gt; <a class="gen" href="${JForumContext.encodeURL("/forums/list")}#${category.id}">${category.title}</a> -&gt; <a class="gen" href="${JForumContext.encodeURL("/forums/show/${forum.id}")}">${forum.name}</a>
						</span>
					</td>
					<td valign="middle" nowrap="nowrap" align="right" width="300"><@pagination.doPagination action, forum.id/></td>
				</tr>

				<tr>
					<td align="left" colspan="2"><span class="nav"></span></td>
				</tr>
			</table>
			</form>
			
			

			<@presentation.forumsComboTable/>

			<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
				<tr>
					<td valign="top" align="center">
						<table cellspacing="3" align="center" cellpadding="0" border="0">
							<tr>
								<td align="middle" width="20">
									<#--img src="${contextPath}/templates/${templateName}/images/folder_new.gif" width="19" height="18" alt="new message icon" title="${I18n.getMessage("unread-message-title")}"/-->
									<img src="${contextPath}/templates/${templateName}/images/folder_new.png" alt="new message icon" title="${I18n.getMessage("unread-message-title")}"/>
								</td>
								<td class="gensmall" align="left">${I18n.getMessage("ForumListing.newMessages")}</td>
								<td>&nbsp;&nbsp;</td>
								<td align="middle" width="20">
									<#--img src="${contextPath}/templates/${templateName}/images/folder_task.gif" width="19" height="18" alt="task icon"/-->
									<#if facilitator>
									<img src="${contextPath}/templates/${templateName}/images/topic_reusable.png" alt="re-use topic icon" title="${I18n.getMessage("reuse-topic-title")}"/>
									<#else>
									<img src="${contextPath}/templates/${templateName}/images/topic_reusable.png" alt="priority topic icon" title="${I18n.getMessage("reuse-topic-priority-title")}"/>
									</#if>	
								</td>
								<#if facilitator>
								<td class="gensmall" align="left">${I18n.getMessage("ForumIndex.reUsableTopic")}</td>
								<#else>
								<td class="gensmall" align="left">${I18n.getMessage("ForumIndex.reUsableTopicPriority")}</td>
								</#if>
								<td>&nbsp;&nbsp;</td>
								<#--
								<td align="middle" width="20">
									<!--img src="${contextPath}/templates/${templateName}/images/read_only_forum.gif" width="19" height="18" alt="read only forum icon" title="${I18n.getMessage("read-only-title")}"/->
									<img src="${contextPath}/templates/${templateName}/images/read_only_lock.png" alt="read only icon" title="${I18n.getMessage("read-only-title")}"/>
								</td>
								<td class="gensmall" align="left">${I18n.getMessage("ForumListing.ReadOnly")}</td>
								-->
								<td align="middle" width="20">
									<img src="${contextPath}/templates/${templateName}/images/topic_lock.png" alt="topic locked icon" title="${I18n.getMessage("locked-forum-topic-title")}"/>	
								</td>
								<td class="gensmall" align="left">${I18n.getMessage("ForumIndex.Locked")}</td>
							</tr>
							<tr>
								<td align="middle" width="20">
									<#--img src="${contextPath}/templates/${templateName}/images/not_yet_open.gif" alt="not yet open icon" title="${I18n.getMessage("not-yet-open-forum-read-title")}"/-->
									<img src="${contextPath}/templates/${templateName}/images/item_not_yet_open.png" alt="not yet open icon" title="${I18n.getMessage("not-yet-open-title")}"/>
								</td>
								<td class="gensmall" align="left">${I18n.getMessage("ForumListing.NotOpen")}</td>
								<td>&nbsp;&nbsp;</td>
								<td align="middle" width="20">
									<#--img src="${contextPath}/templates/${templateName}/images/folder_sticky.gif" width="19" height="18" alt="sticky note icon"/-->
									<img src="${contextPath}/templates/${templateName}/images/topic_sticky.png" alt="sticky topic icon" title="${I18n.getMessage("sticky-topic-title")}"/>
								</td>
								<td class="gensmall" align="left">${I18n.getMessage("ForumIndex.sticky")}</td>
								<td>&nbsp;&nbsp;</td>
								<td align="middle" width="20">
									<#--img src="${contextPath}/templates/${templateName}/images/folder_announce.gif" width="19" height="18" alt="announcement icon"/-->
									<img src="${contextPath}/templates/${templateName}/images/topic_announce.png" alt="announce topic icon" title="${I18n.getMessage("announce-topic-title")}"/>
								</td>
								<td class="gensmall" align="left">${I18n.getMessage("ForumIndex.announce")}</td>		
							</tr>
							<#--
							<tr>
								<td align="middle" width="20">
									<img src="${contextPath}/templates/${templateName}/images/topic_lock.png" alt="topic locked icon" title="${I18n.getMessage("locked-forum-topic-title")}"/>	
								</td>
								<td class="gensmall" align="left">${I18n.getMessage("ForumIndex.Locked")}</td>
								<td colspan="6">&nbsp;&nbsp;</td>								
							</tr>
							-->
							<#if facilitator>
							<tr>
								<td align="middle" width="20">
									<img src="${contextPath}/templates/${templateName}/images/item_invisible.png" alt="not yet open - invisible icon" title="${I18n.getMessage("not-yet-open-invisible-title")}"/>
								</td>
								<td><span class="gensmall">${I18n.getMessage("ForumListing.Invisible")}</span></td>
								<td colspan="6">&nbsp;&nbsp;</td>			
							</tr>
							</#if>	
						</table>
					</td>
					<td align="right"><span class="gensmall"></span></td>
				</tr>
			</table>
		</td>
	</tr>
</table>

<#include "bottom.htm"/>